<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gemini RMMZ Studio</title>
    <link rel="manifest" href='data:application/manifest+json,{"name":"Gemini RMMZ Studio","short_name":"GeminiMZ","start_url":".","display":"standalone","background_color":"#121212","theme_color":"#bb86fc","icons":[{"src":"https://via.placeholder.com/192/bb86fc/ffffff?text=MZ","sizes":"192x192","type":"image/png"}]}'>
    <style>
        :root { --bg: #0f0f0f; --card: #1a1a1a; --accent: #bb86fc; --text: #e0e0e0; --save: #03dac6; --error: #cf6679; --blue: #3700b3; --arcana: #00dbde; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        header { background: var(--card); padding: 12px; border-bottom: 2px solid var(--accent); display: flex; justify-content: space-between; align-items: center; }
        .nav-area { flex: 1; }
        select { width: 100%; padding: 10px; background: #2a2a2a; color: #fff; border: 1px solid var(--accent); border-radius: 6px; font-weight: bold; }
        .branding { text-align: right; padding-left: 15px; }
        .branding span { color: var(--accent); font-size: 14px; font-weight: bold; display: block; }
        main { flex: 1; overflow-y: auto; position: relative; }
        #editorUI { padding: 15px; padding-bottom: 120px; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 20px; border-left: 5px solid var(--accent); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .status-bar { padding: 8px; font-size: 11px; text-align: center; font-weight: bold; }
        .status-missing { background: var(--error); color: #000; }
        .status-ok { background: var(--save); color: #000; }
        label { display: block; font-size: 10px; color: var(--accent); margin-top: 10px; font-weight: bold; text-transform: uppercase; }
        input, textarea { width: 100%; padding: 12px; background: #252525; border: 1px solid #3d3d3d; color: #fff; border-radius: 8px; box-sizing: border-box; margin-top: 5px; }
        .action-bar { position: fixed; bottom: 0; width: 100%; background: #1a1a1a; padding: 15px; display: flex; gap: 10px; box-sizing: border-box; border-top: 1px solid #333; z-index: 1000; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 12px; }
        .btn-load { background: var(--blue); color: #fff; }
        .btn-save { background: var(--save); color: #000; }
        .btn-danger { background: var(--error); color: #fff; width: 100%; margin-top: 10px; }
        .checkerboard { background-color: #1a1a1a; background-image: linear-gradient(45deg, #222 25%, transparent 25%), linear-gradient(-45deg, #222 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #222 75%), linear-gradient(-45deg, transparent 75%, #222 75%); background-size: 20px 20px; padding: 10px; border-radius: 8px; }
        #pixelCanvas { background: transparent; image-rendering: pixelated; border: 2px solid var(--accent); display: block; margin: 10px auto; max-width: 90vw; max-height: 40vh; cursor: crosshair; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<header>
    <div class="nav-area">
        <select id="editorSelect" onchange="handleNavChange(this.value)">
            <option value="Cover">üè† MENU UTAMA</option>
            <optgroup label="DATABASE">
                <option value="Classes">Classes.json</option>
                <option value="Actors">Actors.json</option>
                <option value="Enemies">Enemies.json</option>
            </optgroup>
            <optgroup label="TOOLS">
                <option value="Pixel">Pixel Drawing</option>
            </optgroup>
        </select>
    </div>
    <div class="branding"><span>GeminiMZ</span><small>V.2.9.6</small></div>
</header>

<main>
    <div id="coverPage" style="padding:40px; text-align:center;">
        <h2 style="color:var(--accent)">Selamat Datang, Lur!</h2>
        <p style="font-size:12px; color:#888;">Pilih menu nggo mulai ngedit data RPG Maker MZ-mu.</p>
    </div>

    <div id="editorUI" class="hidden">
        <div id="statusIndicator" class="status-bar status-missing">READY</div>
        <div id="dynamicContent"></div>
    </div>
</main>

<div id="bottomBar" class="action-bar hidden">
    <input type="file" id="universalLoad" class="hidden" accept=".json,.js,.png">
    <button class="btn btn-load" onclick="document.getElementById('universalLoad').click()">MUAT</button>
    <button class="btn btn-save" onclick="handleExport()">EKPORT</button>
</div>

<script>
    let currentMode = 'Cover', db = {}, patches = {}, isDirty = false;
    let pixelData = [], pGridSize = 16, pTool = 'draw';

    function handleNavChange(val) {
        currentMode = val;
        const isCover = val === 'Cover';
        document.getElementById('coverPage').classList.toggle('hidden', !isCover);
        document.getElementById('editorUI').classList.toggle('hidden', isCover);
        document.getElementById('bottomBar').classList.toggle('hidden', isCover);
        if(!isCover) renderMode();
    }

    function renderMode() {
        const container = document.getElementById('dynamicContent');
        const status = document.getElementById('statusIndicator');
        container.innerHTML = "";
        
        if (currentMode === 'Pixel') {
            status.innerText = "PIXEL DRAWING MODE"; status.className = "status-bar status-ok";
            container.innerHTML = `
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;">
                    <div><label>Warna</label><input type="color" id="pCol" value="#bb86fc" style="height:45px;padding:2px;"></div>
                    <div><label>Alat</label><button class="btn btn-load" style="width:100%;height:45px;" onclick="togglePixelTool()" id="pToolBtn">PENSIL</button></div>
                </div>
                <div class="checkerboard"><canvas id="pixelCanvas"></canvas></div>
                <button class="btn btn-danger" onclick="clearPixelCanvas()">üóëÔ∏è HAPUS SEMUA GAMBAR</button>
                <div style="margin-top:10px;"><label>Grid Size</label><input type="number" id="pGrid" value="${pGridSize}" onchange="updatePixelGrid(this.value)"></div>
            `;
            initPixelCanvas(); return;
        }
        updateDBStatus();
        if (!db[currentMode]) {
            container.innerHTML = `<p style="text-align:center;padding:50px;color:#666;">File <b>${currentMode}.json</b> durung dimuat.</p>`;
        } else {
            db[currentMode].forEach((item, idx) => {
                if (!item || item.id === undefined) return;
                const card = document.createElement('div'); card.className = "card";
                card.innerHTML = `<strong>[ID ${item.id}] ${item.name || '---'}</strong><label>Nama</label><input type="text" value="${getVal(currentMode,idx,'name')}" onchange="upd('${currentMode}',${idx},'name',this.value)"><label>Note</label><textarea onchange="upd('${currentMode}',${idx},'note',this.value)">${getVal(currentMode,idx,'note')}</textarea>`;
                container.appendChild(card);
            });
        }
    }

    // --- PIXEL LOGIC ---
    function initPixelCanvas() {
        const canvas = document.getElementById('pixelCanvas'); if(!canvas) return;
        const ctx = canvas.getContext('2d'); canvas.width = canvas.height = 600;
        if (pixelData.length !== pGridSize) pixelData = Array(pGridSize).fill().map(() => Array(pGridSize).fill(null));
        const drawGrid = () => {
            ctx.clearRect(0,0,600,600); let sz = 600/pGridSize;
            pixelData.forEach((row, y) => row.forEach((col, x) => { if(col){ ctx.fillStyle = col; ctx.fillRect(x*sz, y*sz, sz, sz); } }));
            ctx.strokeStyle = "rgba(255,255,255,0.2)"; ctx.lineWidth = 1;
            for(let i=0; i<=pGridSize; i++){ ctx.beginPath(); ctx.moveTo(i*sz,0); ctx.lineTo(i*sz,600); ctx.stroke(); ctx.beginPath(); ctx.moveTo(0,i*sz); ctx.lineTo(600,i*sz); ctx.stroke(); }
        };
        canvas.onclick = (e) => {
            const rect = canvas.getBoundingClientRect();
            const gx = Math.floor(((e.clientX - rect.left) * (600/rect.width)) / (600/pGridSize));
            const gy = Math.floor(((e.clientY - rect.top) * (600/rect.height)) / (600/pGridSize));
            if(gx>=0 && gx<pGridSize && gy>=0 && gy<pGridSize){ pixelData[gy][gx] = (pTool === 'draw') ? document.getElementById('pCol').value : null; drawGrid(); }
        }; drawGrid();
    }
    function clearPixelCanvas() { if(confirm("Hapus kabeh gambar?")) { pixelData = Array(pGridSize).fill().map(() => Array(pGridSize).fill(null)); initPixelCanvas(); } }
    function updatePixelGrid(v){ pGridSize = parseInt(v); pixelData = []; initPixelCanvas(); }
    function togglePixelTool(){ pTool = (pTool === 'draw') ? 'erase' : 'draw'; document.getElementById('pToolBtn').innerText = pTool === 'draw' ? 'PENSIL' : 'PENGHAPUS'; }

    // --- DB LOGIC ---
    function updateDBStatus() { const s = document.getElementById('statusIndicator'); s.innerText = db[currentMode] ? `${currentMode.toUpperCase()} LOADED` : `${currentMode.toUpperCase()} MISSING`; s.className = db[currentMode] ? "status-bar status-ok" : "status-bar status-missing"; }
    function getVal(t,i,k) { return patches[t]?.[i]?.[k] !== undefined ? patches[t][i][k] : (db[t][i][k] || ""); }
    function upd(t,i,k,v) { if(!patches[t]) patches[t]={}; if(!patches[t][i]) patches[t][i]={}; patches[t][i][k]=v; isDirty=true; }
    
    document.getElementById('universalLoad').onchange = function(e) {
        const file = e.target.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
            if(file.name.endsWith('.json')) { db[currentMode] = JSON.parse(ev.target.result); renderMode(); }
        }; reader.readAsText(file);
    };
    function handleExport() {
        if(currentMode === 'Pixel') {
            const out = document.createElement('canvas'); out.width = out.height = pGridSize;
            const oCtx = out.getContext('2d');
            pixelData.forEach((r,y)=>r.forEach((c,x)=>{if(c){oCtx.fillStyle=c;oCtx.fillRect(x,y,1,1);}}));
            const a = document.createElement('a'); a.href = out.toDataURL(); a.download = "GeminiArt.png"; a.click();
        } else {
            const script = `/*: @target MZ @plugindesc Gemini Patch */\nconst GeminiPatch = ${JSON.stringify(patches)};`;
            const blob = new Blob([script], { type: 'text/javascript' });
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = "GeminiPatch.js"; a.click();
        }
    }
</script>
</body>
</html>
